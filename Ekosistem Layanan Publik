import React, { useState } from 'react';
import {
  Shield, Lock, Brain, Cpu, Database, CheckCircle,
  AlertCircle, Activity, Users, FileText, Zap
} from 'lucide-react';

// === Post-Quantum Crypto Simulation ===
class QuantumResistantCrypto {
  static generateKeyPair() {
    const privateKey = Array.from({ length: 32 }, () =>
      Math.floor(Math.random() * 256).toString(16).padStart(2, '0')
    ).join('');

    const publicKey = 'KYBER1024:' + Array.from({ length: 32 }, () =>
      Math.floor(Math.random() * 256).toString(16).padStart(2, '0')
    ).join('');

    return { privateKey, publicKey };
  }

  static sign(data, privateKey) {
    return 'DILITHIUM:' + btoa(data + privateKey).slice(0, 64);
  }

  static verify(data, signature) {
    return signature.startsWith('DILITHIUM:');
  }
}

// === Blockchain Node Simulation ===
class BlockchainNode {
  constructor() {
    this.chain = [];
    this.pendingTransactions = [];
    this.createGenesisBlock();
  }

  createGenesisBlock() {
    const genesis = {
      index: 0,
      timestamp: Date.now(),
      transactions: [],
      previousHash: '0',
      hash: this.calculateHash({ index: 0, timestamp: Date.now(), transactions: [], previousHash: '0' }),
      quantumProof: 'GENESIS_QUANTUM_SEAL'
    };
    this.chain.push(genesis);
  }

  calculateHash(block) {
    const data = JSON.stringify(block);
    let hash = 0;
    for (let i = 0; i < data.length; i++) {
      hash = (hash << 5) - hash + data.charCodeAt(i);
      hash &= hash;
    }
    return Math.abs(hash).toString(16).padStart(64, '0').slice(0, 64);
  }

  addTransaction(transaction) {
    this.pendingTransactions.push(transaction);
  }

  mineBlock() {
    if (this.pendingTransactions.length === 0) return null;

    const block = {
      index: this.chain.length,
      timestamp: Date.now(),
      transactions: [...this.pendingTransactions],
      previousHash: this.chain[this.chain.length - 1].hash,
      hash: '',
      quantumProof: 'QR-' + Math.random().toString(36).slice(2, 11).toUpperCase()
    };

    block.hash = this.calculateHash(block);
    this.chain.push(block);
    this.pendingTransactions = [];
    return block;
  }
}

// === Autonomous AI Security Agent ===
class AutonomousAI {
  static analyzeIdentity(identity) {
    const riskScore = Math.random() * 100;
    const trustLevel =
      riskScore > 70 ? 'Tinggi' :
      riskScore > 40 ? 'Sedang' :
      'Rendah';

    return {
      trustLevel,
      riskScore: riskScore.toFixed(2),
      anomalyDetected: riskScore < 30,
      recommendations: this.generateRecommendations(riskScore)
    };
  }

  static generateRecommendations(score) {
    if (score < 30) {
      return [
        'Aktifkan verifikasi biometrik tambahan',
        'Tunda aktivitas hingga validasi ulang',
        'Audit seluruh login dalam 24 jam terakhir'
      ];
    }

    if (score < 70) {
      return [
        'Pantau aktivitas secara real-time',
        'Terapkan autentikasi multi-factor',
        'Validasi metadata lokasi pengguna'
      ];
    }

    return [
      'Identitas terpercaya — lanjutkan operasi normal',
      'Simpan log keamanan secara berkala'
    ];
  }
}

// === React UI Component ===
export default function QuantumSecurityDashboard() {
  const [keys, setKeys] = useState(null);
  const [node] = useState(new BlockchainNode());
  const [chain, setChain] = useState(node.chain);
  const [identityReport, setIdentityReport] = useState(null);

  const generateKeys = () => setKeys(QuantumResistantCrypto.generateKeyPair());

  const addTransaction = () => {
    node.addTransaction({
      id: crypto.randomUUID(),
      type: 'Identity Verification',
      timestamp: new Date().toISOString()
    });
    alert('✅ Transaksi ditambahkan!');
  };

  const mineBlock = () => {
    const newBlock = node.mineBlock();
    if (newBlock) setChain([...node.chain]);
  };

  const analyzeIdentity = () => {
    const report = AutonomousAI.analyzeIdentity('user123');
    setIdentityReport(report);
  };

  return (
    <div style={{ padding: 24, fontFamily: 'sans-serif', maxWidth: 900, margin: 'auto' }}>
      <h1><Shield /> Quantum Security Dashboard</h1>

      <button onClick={generateKeys}><Lock /> Generate PQC Keypair</button>
      {keys && (
        <pre>
          Public Key: {keys.publicKey}
          {'\n'}
          Private Key: {keys.privateKey}
        </pre>
      )}

      <hr />

      <button onClick={addTransaction}><FileText /> Add Transaction</button>
      <button onClick={mineBlock}><Cpu /> Mine Block</button>

      <h2><Database /> Blockchain</h2>
      <pre>{JSON.stringify(chain, null, 2)}</pre>

      <hr />

      <button onClick={analyzeIdentity}><Brain /> Analyze Identity</button>
      {identityReport && (
        <div>
          <p>Trust Level: {identityReport.trustLevel}</p>
          <p>Risk Score: {identityReport.riskScore}</p>
          <p>
            Status:{' '}
            {identityReport.anomalyDetected
              ? <AlertCircle color="red" />
              : <CheckCircle color="green" />}
          </p>
          <ul>
            {ide
